function Ue(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}const Ke=Object.prototype.toString,qe=Object.prototype.hasOwnProperty;function We(t){return t===void 0}function Xe(t){return Ke.call(t)==="[object Array]"}function Ze(t,e){return qe.call(t,e)}function Kt(t,e){let n,r;if(We(t))return;const i=Xe(t)?Je:Qe;for(let o in t)if(Ze(t,o)&&(n=t[o],r=e(n,i(o)),r===!1))return n}function Qe(t){return t}function Je(t){return Number(t)}function rt(t,...e){const n=t.style;return Kt(e,function(r){r&&Kt(r,function(i,o){n[o]=i})}),t}function ae(t,e,n){return arguments.length==2?t.getAttribute(e):n===null?t.removeAttribute(e):(t.setAttribute(e,n),t)}const tn=Object.prototype.toString;function ce(t){return new z(t)}function z(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}z.prototype.add=function(t){return this.list.add(t),this};z.prototype.remove=function(t){return tn.call(t)=="[object RegExp]"?this.removeMatching(t):(this.list.remove(t),this)};z.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this};z.prototype.toggle=function(t,e){return typeof e<"u"?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this};z.prototype.array=function(){return Array.from(this.list)};z.prototype.has=z.prototype.contains=function(t){return this.list.contains(t)};function ue(t){for(var e;e=t.firstChild;)t.removeChild(e);return t}function en(t,e,n){var r=n?t:t.parentNode;return r&&typeof r.closest=="function"&&r.closest(e)||null}var wt={},xt,Bt,$t;function fe(){xt=window.addEventListener?"addEventListener":"attachEvent",Bt=window.removeEventListener?"removeEventListener":"detachEvent",$t=xt!=="addEventListener"?"on":""}var nn=wt.bind=function(t,e,n,r){return xt||fe(),t[xt]($t+e,n,r||!1),n},rn=wt.unbind=function(t,e,n,r){return Bt||fe(),t[Bt]($t+e,n,r||!1),n},le=Ue({__proto__:null,bind:nn,unbind:rn,default:wt},[wt]),he=["focus","blur"];function on(t,e,n,r,i){return he.indexOf(n)!==-1&&(i=!0),le.bind(t,n,function(o){var s=o.target||o.srcElement;o.delegateTarget=en(s,e,!0),o.delegateTarget&&r.call(t,o)},i)}function sn(t,e,n,r){return he.indexOf(e)!==-1&&(r=!0),le.unbind(t,e,n,r)}var qt={bind:on,unbind:sn},an=cn,de=!1,vt;typeof document<"u"&&(vt=document.createElement("div"),vt.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',de=!vt.getElementsByTagName("link").length,vt=void 0);var R={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:de?[1,"X<div>","</div>"]:[0,"",""]};R.td=R.th=[3,"<table><tbody><tr>","</tr></tbody></table>"];R.option=R.optgroup=[1,'<select multiple="multiple">',"</select>"];R.thead=R.tbody=R.colgroup=R.caption=R.tfoot=[1,"<table>","</table>"];R.polyline=R.ellipse=R.polygon=R.circle=R.text=R.line=R.path=R.rect=R.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];function cn(t,e){if(typeof t!="string")throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if(r=="body"){var c=e.createElement("html");return c.innerHTML=t,c.removeChild(c.lastChild)}var i=Object.prototype.hasOwnProperty.call(R,r)?R[r]:R._default,o=i[0],s=i[1],a=i[2],c=e.createElement("div");for(c.innerHTML=s+t+a;o--;)c=c.lastChild;if(c.firstChild==c.lastChild)return c.removeChild(c.firstChild);for(var l=e.createDocumentFragment();c.firstChild;)l.appendChild(c.removeChild(c.firstChild));return l}var bt=an;function un(t,e){return e=e||document,e.querySelector(t)}function fn(t,e){return e=e||document,e.querySelectorAll(t)}function At(t){t.parentNode&&t.parentNode.removeChild(t)}function ln(t,e){return e={exports:{}},t(e,e.exports),e.exports}var hn=ln(function(t){var e=t.exports=function(n,r){if(r||(r=16),n===void 0&&(n=128),n<=0)return"0";for(var i=Math.log(Math.pow(2,n))/Math.log(r),o=2;i===1/0;o*=2)i=Math.log(Math.pow(2,n/o))/Math.log(r)*o;for(var s=i-Math.floor(i),a="",o=0;o<Math.floor(i);o++){var c=Math.floor(Math.random()*r).toString(r);a=c+a}if(s){var l=Math.pow(r,s),c=Math.floor(Math.random()*l).toString(r);a=c+a}var y=parseInt(a,r);return y!==1/0&&y>=Math.pow(2,n)?e(n,r):a};e.rack=function(n,r,i){var o=function(a){var c=0;do{if(c++>10)if(i)n+=i;else throw new Error("too many ID collisions, use more bits");var l=e(n,r)}while(Object.hasOwnProperty.call(s,l));return s[l]=a,l},s=o.hats={};return o.get=function(a){return o.hats[a]},o.set=function(a,c){return o.hats[a]=c,o},o.bits=n||128,o.base=r||16,o}});function U(t){if(!(this instanceof U))return new U(t);t=t||[128,36,1],this._seed=t.length?hn.rack(t[0],t[1],t[2]):t}U.prototype.next=function(t){return this._seed(t||!0)};U.prototype.nextPrefixed=function(t,e){var n;do n=t+this.next(!0);while(this.assigned(n));return this.claim(n,e),n};U.prototype.claim=function(t,e){this._seed.set(t,e||!0)};U.prototype.assigned=function(t){return this._seed.get(t)||!1};U.prototype.unclaim=function(t){delete this._seed.hats[t]};U.prototype.clear=function(){var t=this._seed.hats,e;for(e in t)this.unclaim(e)};const ut=Object.prototype.toString,dn=Object.prototype.hasOwnProperty;function kt(t){return t===void 0}function tt(t){return t!==void 0}function pe(t){return t==null}function $(t){return ut.call(t)==="[object Array]"}function Rt(t){return ut.call(t)==="[object Object]"}function Z(t){return ut.call(t)==="[object Number]"}function X(t){const e=ut.call(t);return e==="[object Function]"||e==="[object AsyncFunction]"||e==="[object GeneratorFunction]"||e==="[object AsyncGeneratorFunction]"||e==="[object Proxy]"}function It(t){return ut.call(t)==="[object String]"}function ve(t,e){return!pe(t)&&dn.call(t,e)}function Ct(t,e){const n=Vt(e);let r;return x(t,function(i,o){if(n(i,o))return r=i,!1}),r}function $r(t,e){const n=Vt(e);let r=$(t)?-1:void 0;return x(t,function(i,o){if(n(i,o))return r=o,!1}),r}function Wt(t,e){const n=Vt(e);let r=[];return x(t,function(i,o){n(i,o)&&r.push(i)}),r}function x(t,e){let n,r;if(kt(t))return;const i=$(t)?vn:pn;for(let o in t)if(ve(t,o)&&(n=t[o],r=e(n,i(o)),r===!1))return n}function et(t,e,n){return x(t,function(r,i){n=e(n,r,i)}),n}function ye(t,e){return!!et(t,function(n,r,i){return n&&e(r,i)},!0)}function Vr(t,e){return!!Ct(t,e)}function Gr(t,e){let n=[];return x(t,function(r,i){n.push(e(r,i))}),n}function Xt(t){return function(e){return ye(t,function(n,r){return e[r]===n})}}function Vt(t){return X(t)?t:e=>e===t}function pn(t){return t}function vn(t){return Number(t)}function yn(t,e){let n,r,i,o;function s(w){let T=Date.now(),j=w?0:o+e-T;if(j>0)return a(j);t.apply(i,r),c()}function a(w){n=setTimeout(s,w)}function c(){n&&clearTimeout(n),n=o=r=i=void 0}function l(){n&&s(!0),c()}function y(...w){o=Date.now(),r=w,i=this,n||a(e)}return y.flush=l,y.cancel=c,y}function Hr(t,e){let n=!1;return function(...r){n||(t(...r),n=!0,setTimeout(()=>{n=!1},e))}}function ge(t,e){return t.bind(e)}function C(t,...e){return Object.assign(t,...e)}function Dr(t,e,n){let r=t;return x(e,function(i,o){if(typeof i!="number"&&typeof i!="string")throw new Error("illegal key type: "+typeof i+". Key should be of type number or string.");if(i==="constructor")throw new Error("illegal key: constructor");if(i==="__proto__")throw new Error("illegal key: __proto__");let s=e[o+1],a=r[i];tt(s)&&pe(a)&&(a=r[i]=isNaN(+s)?{}:[]),kt(s)?kt(n)?delete r[i]:r[i]=n:r=a}),t}function Yr(t,e){let n={},r=Object(t);return x(e,function(i){i in r&&(n[i]=t[i])}),n}function zr(t,e){let n={},r=Object(t);return x(r,function(i,o){e.indexOf(o)===-1&&(n[o]=i)}),n}function ft(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function gn(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch{}return t}function _n(t,e){return e.appendChild(gn(t,e))}function G(t,e){return _n(e,t),t}var Nt=2,_e={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":Nt,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":Nt,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function mn(t,e){return _e[e]?t.style[e]:t.getAttributeNS(null,e)}function me(t,e,n){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=_e[r];i?(i===Nt&&typeof n=="number"&&(n=String(n)+"px"),t.style[r]=n):t.setAttributeNS(null,e,n)}function wn(t,e){var n=Object.keys(e),r,i;for(r=0,i;i=n[r];r++)me(t,i,e[i])}function E(t,e,n){if(typeof e=="string")if(n!==void 0)me(t,e,n);else return mn(t,e);else wn(t,e);return t}const xn=Object.prototype.toString;function H(t){return new K(t)}function K(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}K.prototype.add=function(t){return this.list.add(t),this};K.prototype.remove=function(t){return xn.call(t)=="[object RegExp]"?this.removeMatching(t):(this.list.remove(t),this)};K.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this};K.prototype.toggle=function(t,e){return typeof e<"u"?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this};K.prototype.array=function(){return Array.from(this.list)};K.prototype.has=K.prototype.contains=function(t){return this.list.contains(t)};var Gt={svg:"http://www.w3.org/2000/svg"},Zt='<svg xmlns="'+Gt.svg+'"';function bn(t){var e=!1;t.substring(0,4)==="<svg"?t.indexOf(Gt.svg)===-1&&(t=Zt+t.substring(4)):(t=Zt+">"+t+"</svg>",e=!0);var n=En(t);if(!e)return n;for(var r=document.createDocumentFragment(),i=n.firstChild;i.firstChild;)r.appendChild(i.firstChild);return r}function En(t){var e;return e=new DOMParser,e.async=!1,e.parseFromString(t,"text/xml")}function L(t,e){var n;return t=t.trim(),t.charAt(0)==="<"?(n=bn(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(Gt.svg,t),e&&E(n,e),n}var jt=null;function we(){return jt===null&&(jt=L("svg")),jt}function Qt(t,e){var n,r,i=Object.keys(e);for(n=0;r=i[n];n++)t[r]=e[r];return t}function Rn(t,e,n,r,i,o){var s=we().createSVGMatrix();switch(arguments.length){case 0:return s;case 1:return Qt(s,t);case 6:return Qt(s,{a:t,b:e,c:n,d:r,e:i,f:o})}}function st(t){return we().createSVGTransform()}var Jt=/([&<>]{1})/g,Cn=/([&<>\n\r"]{1})/g,On={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function Mt(t,e){function n(r,i){return On[i]||i}return t.replace(e,n)}function xe(t,e){var n,r,i,o,s;switch(t.nodeType){case 3:e.push(Mt(t.textContent,Jt));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(i=t.attributes,n=0,r=i.length;n<r;++n)o=i.item(n),e.push(" ",o.name,'="',Mt(o.value,Cn),'"');if(t.hasChildNodes()){for(e.push(">"),s=t.childNodes,n=0,r=s.length;n<r;++n)xe(s.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("<!--",Mt(t.nodeValue,Jt),"-->");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function Sn(t){for(var e=t.firstChild,n=[];e;)xe(e,n),e=e.nextSibling;return n.join("")}function Ur(t,e){return Sn(t)}function lt(t){var e=t.parentNode;return e&&e.removeChild(t),t}function Tn(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function jn(t,e){var n,r;for(t.clear(),n=0;r=e[n];n++)t.appendItem(Tn(t,r))}function at(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),jn(n,e)),n.consolidate()}var Mn=1e3;function Q(t,e){var n=this;e=e||Mn,t.on(["render.shape","render.connection"],e,function(r,i){var o=r.type,s=i.element,a=i.gfx,c=i.attrs;if(n.canRender(s))return o==="render.shape"?n.drawShape(a,s,c):n.drawConnection(a,s,c)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(r,i){if(n.canRender(i))return r.type==="render.getShapePath"?n.getShapePath(i):n.getConnectionPath(i)})}Q.prototype.canRender=function(t){};Q.prototype.drawShape=function(t,e){};Q.prototype.drawConnection=function(t,e){};Q.prototype.getShapePath=function(t){};Q.prototype.getConnectionPath=function(t){};function Ln(t){return Rt(t)&&ve(t,"waypoints")}function Ht(t){return t.flat().join(",").replace(/,?([A-Za-z]),?/g,"$1")}function Pn(t){return["M",t.x,t.y]}function Lt(t){return["L",t.x,t.y]}function Bn(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function An(t,e){const n=t.length,r=[Pn(t[0])];for(let i=1;i<n;i++){const o=t[i-1],s=t[i],a=t[i+1];if(!a||!e){r.push(Lt(s));continue}const c=Math.min(e,Ft(s.x-o.x,s.y-o.y),Ft(a.x-s.x,a.y-s.y));if(!c){r.push(Lt(s));continue}const l=yt(s,o,c),y=yt(s,o,c*.5),w=yt(s,a,c),T=yt(s,a,c*.5);r.push(Lt(l)),r.push(Bn(y,T,w))}return r}function yt(t,e,n){const r=e.x-t.x,i=e.y-t.y,o=Ft(r,i),s=n/o;return{x:t.x+r*s,y:t.y+i*s}}function Ft(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function be(t,e,n){Z(e)&&(n=e,e=null),e||(e={});const r=L("path",e);return Z(n)&&(r.dataset.cornerRadius=String(n)),Ee(r,t)}function Ee(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return E(t,{d:Ht(An(e,n))}),t}function Kr(t,e,n,r,i){var o=st();o.setTranslate(e,n);var s=st();s.setRotate(r||0,0,0);var a=st();a.setScale(1,1),at(t,[o,s,a])}function kn(t,e,n){var r=st();r.setTranslate(e,n),at(t,r)}function qr(t,e){var n=st();n.setRotate(e,0,0),at(t,n)}var In=0,Nn={width:150,height:50};function Fn(t){var e=t.split("-");return{horizontal:e[0]||"center",vertical:e[1]||"top"}}function $n(t){return Rt(t)?C({top:0,left:0,right:0,bottom:0},t):{top:t,left:t,right:t,bottom:t}}function Vn(t,e){e.textContent=t;var n;try{var r,i=t==="";return e.textContent=i?"dummy":t,n=e.getBBox(),r={width:n.width+n.x*2,height:n.height},i&&(r.width=0),r}catch(o){return console.log(o),{width:0,height:0}}}function Gn(t,e,n){for(var r=t.shift(),i=r,o;;){if(o=Vn(i,n),o.width=i?o.width:0,i===" "||i===""||o.width<Math.round(e)||i.length<2)return Hn(t,i,r,o);i=Yn(i,o.width,e)}}function Hn(t,e,n,r){if(e.length<n.length){var i=n.slice(e.length).trim();t.unshift(i)}return{width:r.width,height:r.height,text:e}}var te="Â­";function Dn(t,e){var n=t.split(/(\s|-|\u00AD)/g),r,i=[],o=0;if(n.length>1)for(;r=n.shift();)if(r.length+o<e)i.push(r),o+=r.length;else{(r==="-"||r===te)&&i.pop();break}var s=i[i.length-1];return s&&s===te&&(i[i.length-1]="-"),i.join("")}function Yn(t,e,n){var r=Math.max(t.length*(n/e),1),i=Dn(t,r);return i||(i=t.slice(0,Math.max(Math.round(r-1),1))),i}function zn(){var t=document.getElementById("helper-svg");return t||(t=L("svg"),E(t,{id:"helper-svg"}),rt(t,{visibility:"hidden",position:"fixed",width:0,height:0}),document.body.appendChild(t)),t}function Dt(t){this._config=C({},{size:Nn,padding:In,style:{},align:"center-top"},t||{})}Dt.prototype.createText=function(t,e){return this.layoutText(t,e).element};Dt.prototype.getDimensions=function(t,e){return this.layoutText(t,e).dimensions};Dt.prototype.layoutText=function(t,e){var n=C({},this._config.size,e.box),r=C({},this._config.style,e.style),i=Fn(e.align||this._config.align),o=$n(e.padding!==void 0?e.padding:this._config.padding),s=e.fitBox||!1,a=Un(r),c=t.split(/\u00AD?\r?\n/),l=[],y=n.width-o.left-o.right,w=L("text");E(w,{x:0,y:0}),E(w,r);var T=zn();for(G(T,w);c.length;)l.push(Gn(c,y,w));i.vertical==="middle"&&(o.top=o.bottom=0);var j=et(l,function(B,u,v){return B+(a||u.height)},0)+o.top+o.bottom,I=et(l,function(B,u,v){return u.width>B?u.width:B},0),M=o.top;i.vertical==="middle"&&(M+=(n.height-j)/2),M-=(a||l[0].height)/4;var W=L("text");E(W,r),x(l,function(B){var u;switch(M+=a||B.height,i.horizontal){case"left":u=o.left;break;case"right":u=(s?I:y)-o.right-B.width;break;default:u=Math.max(((s?I:y)-B.width)/2+o.left,0)}var v=L("tspan");E(v,{x:u,y:M}),v.textContent=B.text,G(W,v)}),lt(w);var J={width:I,height:j};return{dimensions:J,element:W}};function Un(t){if("fontSize"in t&&"lineHeight"in t)return t.lineHeight*parseInt(t.fontSize,10)}function Kn(t,e){return e=e||{},t.replace(/{([^}]+)}/g,function(n,r){return e[r]||"{"+r+"}"})}const Wr={translate:["value",Kn]};function qn(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function ee(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Xr(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function Wn(t){return qn({x:t.x+(t.width||0)/2,y:t.y+(t.height||0)/2})}function Xn(t){for(var e=t.waypoints,n=e.reduce(function(l,y,w){var T=e[w-1];if(T){var j=l[l.length-1],I=j&&j.endLength||0,M=Zn(T,y);l.push({start:T,end:y,startLength:I,endLength:I+M,length:M})}return l},[]),r=n.reduce(function(l,y){return l+y.length},0),i=r/2,o=0,s=n[o];s.endLength<i;)s=n[++o];var a=(i-s.startLength)/s.length,c={x:s.start.x+(s.end.x-s.start.x)*a,y:s.start.y+(s.end.y-s.start.y)*a};return c}function Zr(t){return Ln(t)?Xn(t):Wn(t)}function Zn(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ct(t,e){e=!!e,$(t)||(t=[t]);var n,r,i,o;return x(t,function(s){var a=s;s.waypoints&&!e&&(a=ct(s.waypoints,!0));var c=a.x,l=a.y,y=a.height||0,w=a.width||0;(c<n||n===void 0)&&(n=c),(l<r||r===void 0)&&(r=l),(c+w>i||i===void 0)&&(i=c+w),(l+y>o||o===void 0)&&(o=l+y)}),{x:n,y:r,height:o-r,width:i-n}}function Qn(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function Re(t){return!!(t&&t.isFrame)}function Ce(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(Math.random()*1e9)+"-"}Ce.prototype.next=function(){return this._prefix+ ++this._counter};var Jn=new Ce("ov"),tr=500;function O(t,e,n,r){this._eventBus=e,this._canvas=n,this._elementRegistry=r,this._ids=Jn,this._overlayDefaults=C({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=er(n.getContainer()),this._init()}O.$inject=["config.overlays","eventBus","canvas","elementRegistry"];O.prototype.get=function(t){if(It(t)&&(t={id:t}),It(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?Wt(e.overlays,Xt({type:t.type})):e.overlays.slice():[]}else return t.type?Wt(this._overlays,Xt({type:t.type})):t.id?this._overlays[t.id]:null};O.prototype.add=function(t,e,n){if(Rt(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var r=this._ids.next();return n=C({},this._overlayDefaults,n,{id:r,type:e,element:t,html:n.html}),this._addOverlay(n),r};O.prototype.remove=function(t){var e=this.get(t)||[];$(e)||(e=[e]);var n=this;x(e,function(r){var i=n._getOverlayContainer(r.element,!0);if(r&&(At(r.html),At(r.htmlContainer),delete r.htmlContainer,delete r.element,delete n._overlays[r.id]),i){var o=i.overlays.indexOf(r);o!==-1&&i.overlays.splice(o,1)}})};O.prototype.isShown=function(){return this._overlayRoot.style.display!=="none"};O.prototype.show=function(){Ot(this._overlayRoot)};O.prototype.hide=function(){Ot(this._overlayRoot,!1)};O.prototype.clear=function(){this._overlays={},this._overlayContainers=[],ue(this._overlayRoot)};O.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,r=e.x,i=e.y;if(e.waypoints){var o=ct(e);r=o.x,i=o.y}Oe(n,r,i),ae(t.html,"data-container-id",e.id)};O.prototype._updateOverlay=function(t){var e=t.position,n=t.htmlContainer,r=t.element,i=e.left,o=e.top;if(e.right!==void 0){var s;r.waypoints?s=ct(r).width:s=r.width,i=e.right*-1+s}if(e.bottom!==void 0){var a;r.waypoints?a=ct(r).height:a=r.height,o=e.bottom*-1+a}Oe(n,i||0,o||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())};O.prototype._createOverlayContainer=function(t){var e=bt('<div class="djs-overlays" />');rt(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n};O.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";Se(this._overlayRoot,n)};O.prototype._getOverlayContainer=function(t,e){var n=Ct(this._overlayContainers,function(r){return r.element===t});return!n&&!e?this._createOverlayContainer(t):n};O.prototype._addOverlay=function(t){var e=t.id,n=t.element,r=t.html,i,o;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),It(r)&&(r=bt(r)),o=this._getOverlayContainer(n),i=bt('<div class="djs-overlay" data-overlay-id="'+e+'">'),rt(i,{position:"absolute"}),i.appendChild(r),t.type&&ce(i).add("djs-overlay-"+t.type);var s=this._canvas.findRoot(n),a=this._canvas.getRootElement();Ot(i,s===a),t.htmlContainer=i,o.overlays.push(t),o.html.appendChild(i),this._overlays[e]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())};O.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,r=this._canvas.findRoot(t.element),i=n&&n.minZoom,o=n&&n.maxZoom,s=t.htmlContainer,a=this._canvas.getRootElement(),c=!0;(r!==a||n&&(tt(i)&&i>e.scale||tt(o)&&o<e.scale))&&(c=!1),Ot(s,c),this._updateOverlayScale(t,e)};O.prototype._updateOverlayScale=function(t,e){var n=t.scale,r,i,o=t.htmlContainer,s,a="";n!==!0&&(n===!1?(r=1,i=1):(r=n.min,i=n.max),tt(r)&&e.scale<r&&(s=(1/e.scale||1)*r),tt(i)&&e.scale>i&&(s=(1/e.scale||1)*i)),tt(s)&&(a="scale("+s+","+s+")"),Se(o,a)};O.prototype._updateOverlaysVisibilty=function(t){var e=this;x(this._overlays,function(n){e._updateOverlayVisibilty(n,t)})};O.prototype._init=function(){var t=this._eventBus,e=this;function n(r){e._updateRoot(r),e._updateOverlaysVisibilty(r),e.show()}t.on("canvas.viewbox.changing",function(r){e.hide()}),t.on("canvas.viewbox.changed",function(r){n(r.viewbox)}),t.on(["shape.remove","connection.remove"],function(r){var i=r.element,o=e.get({element:i});x(o,function(c){e.remove(c.id)});var s=e._getOverlayContainer(i);if(s){At(s.html);var a=e._overlayContainers.indexOf(s);a!==-1&&e._overlayContainers.splice(a,1)}}),t.on("element.changed",tr,function(r){var i=r.element,o=e._getOverlayContainer(i,!0);o&&(x(o.overlays,function(s){e._updateOverlay(s)}),e._updateOverlayContainer(o))}),t.on("element.marker.update",function(r){var i=e._getOverlayContainer(r.element,!0);i&&ce(i.html)[r.add?"add":"remove"](r.marker)}),t.on("root.set",function(){e._updateOverlaysVisibilty(e._canvas.viewbox())}),t.on("diagram.clear",this.clear,this)};function er(t){var e=bt('<div class="djs-overlay-container" />');return rt(e,{position:"absolute",width:0,height:0}),t.insertBefore(e,t.firstChild),e}function Oe(t,e,n){rt(t,{left:e+"px",top:n+"px"})}function Ot(t,e){t.style.display=e===!1?"none":""}function Se(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach(function(n){t.style[n+"transform"]=e})}const Qr={__init__:["overlays"],overlays:["type",O]};var nr=1e3;function V(t){this._eventBus=t}V.$inject=["eventBus"];function rr(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}V.prototype.on=function(t,e,n,r,i,o){if((X(e)||Z(e))&&(o=i,i=r,r=n,n=e,e=null),X(n)&&(o=i,i=r,r=n,n=nr),Rt(i)&&(o=i,i=!1),!X(r))throw new Error("handlerFn must be a function");$(t)||(t=[t]);var s=this._eventBus;x(t,function(a){var c=["commandStack",a,e].filter(function(l){return l}).join(".");s.on(c,n,i?rr(r,o):r,o)})};V.prototype.canExecute=D("canExecute");V.prototype.preExecute=D("preExecute");V.prototype.preExecuted=D("preExecuted");V.prototype.execute=D("execute");V.prototype.executed=D("executed");V.prototype.postExecute=D("postExecute");V.prototype.postExecuted=D("postExecuted");V.prototype.revert=D("revert");V.prototype.reverted=D("reverted");function D(t){return function(n,r,i,o,s){(X(n)||Z(n))&&(s=o,o=i,i=r,r=n,n=null),this.on(n,t,r,i,o,s)}}function Te(t){return t.originalEvent||t.srcEvent}function Jr(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function je(t,e){return(Te(t)||t).button===e}function St(t){return je(t,0)}function ir(t){return je(t,1)}function or(t){var e=Te(t)||t;return St(t)&&e.shiftKey}function sr(t){return!0}function gt(t){return St(t)||ir(t)}var ne=500;function Me(t,e,n){var r=this;function i(f,p,h){if(!a(f,p)){var _,b,Y;h?b=e.getGraphics(h):(_=p.delegateTarget||p.target,_&&(b=_,h=e.get(b))),!(!b||!h)&&(Y=t.fire(f,{element:h,gfx:b,originalEvent:p}),Y===!1&&(p.stopPropagation(),p.preventDefault()))}}var o={};function s(f){return o[f]}function a(f,p){var h=l[f]||St;return!h(p)}var c={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},l={"element.contextmenu":sr,"element.mousedown":gt,"element.mouseup":gt,"element.click":gt,"element.dblclick":gt};function y(f,p,h){var _=c[f];if(!_)throw new Error("unmapped DOM event name <"+f+">");return i(_,p,h)}var w="svg, .djs-element";function T(f,p,h,_){var b=o[h]=function(Y){i(h,Y)};_&&(l[h]=_),b.$delegate=qt.bind(f,w,p,b)}function j(f,p,h){var _=s(h);_&&qt.unbind(f,p,_.$delegate)}function I(f){x(c,function(p,h){T(f,h,p)})}function M(f){x(c,function(p,h){j(f,h,p)})}t.on("canvas.destroy",function(f){M(f.svg)}),t.on("canvas.init",function(f){I(f.svg)}),t.on(["shape.added","connection.added"],function(f){var p=f.element,h=f.gfx;t.fire("interactionEvents.createHit",{element:p,gfx:h})}),t.on(["shape.changed","connection.changed"],ne,function(f){var p=f.element,h=f.gfx;t.fire("interactionEvents.updateHit",{element:p,gfx:h})}),t.on("interactionEvents.createHit",ne,function(f){var p=f.element,h=f.gfx;r.createDefaultHit(p,h)}),t.on("interactionEvents.updateHit",function(f){var p=f.element,h=f.gfx;r.updateDefaultHit(p,h)});var W=g("djs-hit djs-hit-stroke"),J=g("djs-hit djs-hit-click-stroke"),B=g("djs-hit djs-hit-all"),u=g("djs-hit djs-hit-no-move"),v={all:B,"click-stroke":J,stroke:W,"no-move":u};function g(f,p){return p=C({stroke:"white",strokeWidth:15},p||{}),n.cls(f,["no-fill","no-border"],p)}function m(f,p){var h=v[p];if(!h)throw new Error("invalid hit type <"+p+">");return E(f,h),f}function S(f,p){G(f,p)}this.removeHits=function(f){var p=fn(".djs-hit",f);x(p,lt)},this.createDefaultHit=function(f,p){var h=f.waypoints,_=f.isFrame,b;return h?this.createWaypointsHit(p,h):(b=_?"stroke":"all",this.createBoxHit(p,b,{width:f.width,height:f.height}))},this.createWaypointsHit=function(f,p){var h=be(p);return m(h,"stroke"),S(f,h),h},this.createBoxHit=function(f,p,h){h=C({x:0,y:0},h);var _=L("rect");return m(_,p),E(_,h),S(f,_),_},this.updateDefaultHit=function(f,p){var h=un(".djs-hit",p);if(h)return f.waypoints?Ee(h,f.waypoints):E(h,{width:f.width,height:f.height}),h},this.fire=i,this.triggerMouseEvent=y,this.mouseHandler=s,this.registerEvent=T,this.unregisterEvent=j}Me.$inject=["eventBus","elementRegistry","styles"];const ar={__init__:["interactionEvents"],interactionEvents:["type",Me]};function it(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],function(r){var i=r.element;n.deselect(i)}),t.on(["diagram.clear","root.set"],function(r){n.select(null)})}it.$inject=["eventBus","canvas"];it.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(n!==-1){var r=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:r,newSelection:e})}};it.prototype.get=function(){return this._selectedElements};it.prototype.isSelected=function(t){return this._selectedElements.indexOf(t)!==-1};it.prototype.select=function(t,e){var n=this._selectedElements,r=n.slice();$(t)||(t=t?[t]:[]);var i=this._canvas,o=i.getRootElement();t=t.filter(function(s){var a=i.findRoot(s);return o===a}),e?x(t,function(s){n.indexOf(s)===-1&&n.push(s)}):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:r,newSelection:n})};var re="hover",ie="selected";function Le(t,e){this._canvas=t;function n(i,o){t.addMarker(i,o)}function r(i,o){t.removeMarker(i,o)}e.on("element.hover",function(i){n(i.element,re)}),e.on("element.out",function(i){r(i.element,re)}),e.on("selection.changed",function(i){function o(l){r(l,ie)}function s(l){n(l,ie)}var a=i.oldSelection,c=i.newSelection;x(a,function(l){c.indexOf(l)===-1&&o(l)}),x(c,function(l){a.indexOf(l)===-1&&s(l)})})}Le.$inject=["canvas","eventBus"];function Pe(t,e,n,r){t.on("create.end",500,function(i){var o=i.context,s=o.canExecute,a=o.elements,c=o.hints||{},l=c.autoSelect;if(s){if(l===!1)return;$(l)?e.select(l):e.select(a.filter(cr))}}),t.on("connect.end",500,function(i){var o=i.context,s=o.connection;s&&e.select(s)}),t.on("shape.move.end",500,function(i){var o=i.previousSelection||[],s=r.get(i.context.shape.id),a=Ct(o,function(c){return s.id===c.id});a||e.select(s)}),t.on("element.click",function(i){if(St(i)){var o=i.element;o===n.getRootElement()&&(o=null);var s=e.isSelected(o),a=e.get().length>1,c=or(i);if(s&&a)return c?e.deselect(o):e.select(o);s?e.deselect(o):e.select(o,c)}})}Pe.$inject=["eventBus","selection","canvas","elementRegistry"];function cr(t){return!t.hidden}const ti={__init__:["selectionVisuals","selectionBehavior"],__depends__:[ar],selection:["type",it],selectionVisuals:["type",Le],selectionBehavior:["type",Pe]},ur=/^class[ {]/;function fr(t){return ur.test(t.toString())}function Yt(t){return Array.isArray(t)}function Pt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _t(...t){t.length===1&&Yt(t[0])&&(t=t[0]),t=[...t];const e=t.pop();return e.$inject=t,e}const lr=/constructor\s*[^(]*\(\s*([^)]*)\)/m,hr=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,dr=/\/\*([^*]*)\*\//m;function pr(t){if(typeof t!="function")throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(fr(t)?lr:hr);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map(r=>{const i=r.match(dr);return(i&&i[1]||r).trim()})||[]}function Be(t,e){const n=e||{get:function(u,v){if(r.push(u),v===!1)return null;throw a(`No provider for "${u}"!`)}},r=[],i=this._providers=Object.create(n._providers||null),o=this._instances=Object.create(null),s=o.injector=this,a=function(u){const v=r.join(" -> ");return r.length=0,new Error(v?`${u} (Resolving: ${v})`:u)};function c(u,v){if(!i[u]&&u.includes(".")){const g=u.split(".");let m=c(g.shift());for(;g.length;)m=m[g.shift()];return m}if(Pt(o,u))return o[u];if(Pt(i,u)){if(r.indexOf(u)!==-1)throw r.push(u),a("Cannot resolve circular dependency!");return r.push(u),o[u]=i[u][0](i[u][1]),r.pop(),o[u]}return n.get(u,v)}function l(u,v){if(typeof v>"u"&&(v={}),typeof u!="function")if(Yt(u))u=_t(u.slice());else throw a(`Cannot invoke "${u}". Expected a function!`);const m=(u.$inject||pr(u)).map(S=>Pt(v,S)?v[S]:c(S));return{fn:u,dependencies:m}}function y(u){const{fn:v,dependencies:g}=l(u),m=Function.prototype.bind.call(v,null,...g);return new m}function w(u,v,g){const{fn:m,dependencies:S}=l(u,g);return m.apply(v,S)}function T(u){return _t(v=>u.get(v))}function j(u,v){if(v&&v.length){const g=Object.create(null),m=Object.create(null),S=[],f=[],p=[];let h,_,b,Y;for(let N in i)h=i[N],v.indexOf(N)!==-1&&(h[2]==="private"?(_=S.indexOf(h[3]),_===-1?(b=h[3].createChild([],v),Y=T(b),S.push(h[3]),f.push(b),p.push(Y),g[N]=[Y,N,"private",b]):g[N]=[p[_],N,"private",f[_]]):g[N]=[h[2],h[1]],m[N]=!0),(h[2]==="factory"||h[2]==="type")&&h[1].$scope&&v.forEach(Ut=>{h[1].$scope.indexOf(Ut)!==-1&&(g[N]=[h[2],h[1]],m[Ut]=!0)});v.forEach(N=>{if(!m[N])throw new Error('No provider for "'+N+'". Cannot use provider from the parent!')}),u.unshift(g)}return new Be(u,s)}const I={factory:w,type:y,value:function(u){return u}};function M(u,v){const g=u.__init__||[];return function(){g.forEach(m=>{typeof m=="string"?v.get(m):v.invoke(m)})}}function W(u){const v=u.__exports__;if(v){const g=u.__modules__,m=Object.keys(u).reduce((_,b)=>(b!=="__exports__"&&b!=="__modules__"&&b!=="__init__"&&b!=="__depends__"&&(_[b]=u[b]),_),Object.create(null)),S=(g||[]).concat(m),f=j(S),p=_t(function(_){return f.get(_)});v.forEach(function(_){i[_]=[p,_,"private",f]});const h=(u.__init__||[]).slice();return h.unshift(function(){f.init()}),u=Object.assign({},u,{__init__:h}),M(u,f)}return Object.keys(u).forEach(function(g){if(g==="__init__"||g==="__depends__")return;const m=u[g];if(m[2]==="private"){i[g]=m;return}const S=m[0],f=m[1];i[g]=[I[S],vr(S,f),S]}),M(u,s)}function J(u,v){return u.indexOf(v)!==-1||(u=(v.__depends__||[]).reduce(J,u),u.indexOf(v)!==-1)?u:u.concat(v)}function B(u){const v=u.reduce(J,[]).map(W);let g=!1;return function(){g||(g=!0,v.forEach(m=>m()))}}this.get=c,this.invoke=w,this.instantiate=y,this.createChild=j,this.init=B(t)}function vr(t,e){return t!=="value"&&Yt(e)&&(e=_t(e.slice())),e}var yr=1;function q(t,e){Q.call(this,t,yr),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}ft(q,Q);q.prototype.canRender=function(){return!0};q.prototype.drawShape=function(e,n,r){var i=L("rect");return E(i,{x:0,y:0,width:n.width||0,height:n.height||0}),Re(n)?E(i,C({},this.FRAME_STYLE,r||{})):E(i,C({},this.SHAPE_STYLE,r||{})),G(e,i),i};q.prototype.drawConnection=function(e,n,r){var i=be(n.waypoints,C({},this.CONNECTION_STYLE,r||{}));return G(e,i),i};q.prototype.getShapePath=function(e){var n=e.x,r=e.y,i=e.width,o=e.height,s=[["M",n,r],["l",i,0],["l",0,o],["l",-i,0],["z"]];return Ht(s)};q.prototype.getConnectionPath=function(e){var n=e.waypoints,r,i,o=[];for(r=0;i=n[r];r++)i=i.original||i,o.push([r===0?"M":"L",i.x,i.y]);return Ht(o)};q.$inject=["eventBus","styles"];function gr(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(n,r,i){var o=this.style(r,i);return C(o,{class:n})},this.style=function(n,r){!$(n)&&!r&&(r=n,n=[]);var i=et(n,function(o,s){return C(o,t[s]||{})},{});return r?C(i,r):i},this.computeStyle=function(n,r,i){return $(r)||(i=r,r=[]),e.style(r||[],C({},i,n||{}))}}const _r={__init__:["defaultRenderer"],defaultRenderer:["type",q],styles:["type",gr]};function mr(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return n!==-1&&t.splice(n,1),n}function wr(t,e,n){if(!(!t||!e)){typeof n!="number"&&(n=-1);var r=t.indexOf(e);if(r!==-1){if(r===n)return;if(n!==-1)t.splice(r,1);else return}n!==-1?t.splice(n,0,e):t.push(e)}}function mt(t,e){return Math.round(t*e)/e}function oe(t){return Z(t)?t+"px":t}function xr(t){for(;t.parent;)t=t.parent;return t}function br(t){t=C({},{width:"100%",height:"100%"},t);const e=t.container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),rt(n,{position:"relative",overflow:"hidden",width:oe(t.width),height:oe(t.height)}),e.appendChild(n),n}function Ae(t,e,n){const r=L("g");H(r).add(e);const i=n!==void 0?n:t.childNodes.length-1;return t.insertBefore(r,t.childNodes[i]||null),r}const Er="base",ke=0,Rr=1,Cr={shape:["x","y","width","height"],connection:["waypoints"]};function d(t,e,n,r){this._eventBus=e,this._elementRegistry=r,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._focused=!1,this._init(t||{})}d.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"];d.prototype._init=function(t){const e=this._eventBus,n=this._container=br(t),r=this._svg=L("svg");E(r,{width:"100%",height:"100%"}),ae(r,"tabindex",0),t.autoFocus&&e.on("element.hover",()=>{this.restoreFocus()}),e.on("element.mousedown",500,o=>{this.focus()}),r.addEventListener("focusin",()=>{this._setFocused(!0)}),r.addEventListener("focusout",()=>{this._setFocused(!1)}),G(n,r);const i=this._viewport=Ae(r,"viewport");t.deferUpdate&&(this._viewboxChanged=yn(ge(this._viewboxChanged,this),300)),e.on("diagram.init",()=>{e.fire("canvas.init",{svg:r,viewport:i})}),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],()=>{delete this._cachedViewbox}),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)};d.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport};d.prototype._setFocused=function(t){t!=this._focused&&(this._focused=t,this._eventBus.fire("canvas.focus.changed",{focused:t}))};d.prototype._clear=function(){this._elementRegistry.getAll().forEach(e=>{const n=Qn(e);n==="root"?this.removeRootElement(e):this._removeElement(e,n)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox};d.prototype.focus=function(){this._svg.focus({preventScroll:!0}),this._setFocused(!0)};d.prototype.restoreFocus=function(){document.activeElement===document.body&&this.focus()};d.prototype.isFocused=function(){return this._focused};d.prototype.getDefaultLayer=function(){return this.getLayer(Er,ke)};d.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),typeof e<"u"&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group};d.prototype._getChildIndex=function(t){return et(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)};d.prototype._createLayer=function(t,e){typeof e>"u"&&(e=Rr);const n=this._getChildIndex(e);return{group:Ae(this._viewport,"layer-"+t,n),index:e,visible:!0}};d.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,r=e.group,i=e.index;if(e.visible)return r;const o=this._getChildIndex(i);return n.insertBefore(r,n.childNodes[o]||null),e.visible=!0,r};d.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible&&(lt(n),e.visible=!1),n};d.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],lt(e.group))};d.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null};d.prototype.findRoot=function(t){return typeof t=="string"&&(t=this._elementRegistry.get(t)),t?(this._findPlaneForRoot(xr(t))||{}).rootElement:void 0};d.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})};d.prototype._findPlaneForRoot=function(t){return Ct(this._planes,function(e){return e.rootElement===t})};d.prototype.getContainer=function(){return this._container};d.prototype._updateMarker=function(t,e,n){let r;t.id||(t=this._elementRegistry.get(t)),t.markers=t.markers||new Set,r=this._elementRegistry._elements[t.id],r&&(x([r.gfx,r.secondaryGfx],function(i){i&&(n?(t.markers.add(e),H(i).add(e)):(t.markers.delete(e),H(i).remove(e)))}),this._eventBus.fire("element.marker.update",{element:t,gfx:r.gfx,marker:e,add:!!n}))};d.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)};d.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)};d.prototype.hasMarker=function(t,e){return t.id||(t=this._elementRegistry.get(t)),t.markers?t.markers.has(e):!1};d.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)};d.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))};d.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const r=this.getLayer(n,ke);return this.hideLayer(n),this._addRoot(t,r),this._planes.push({rootElement:t,layer:r}),t};d.prototype.removeRootElement=function(t){if(typeof t=="string"&&(t=this._elementRegistry.get(t)),!!this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(n){return n.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t};d.prototype.setRootElement=function(t){if(t===this._rootElement)return t;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t};d.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)};d.prototype._addRoot=function(t,e){const n=this._elementRegistry,r=this._eventBus;r.fire("root.add",{element:t}),n.add(t,e),r.fire("root.added",{element:t,gfx:e})};d.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})};d.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=Cr[t];if(!ye(n,function(i){return typeof e[i]<"u"}))throw new Error("must supply { "+n.join(", ")+" } with "+t)};d.prototype._setParent=function(t,e,n){wr(e.children,t,n),t.parent=e};d.prototype._addElement=function(t,e,n,r){n=n||this.getRootElement();const i=this._eventBus,o=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,r);const s=o.create(t,e,r);return this._elementRegistry.add(e,s),o.update(t,e,s),i.fire(t+".added",{element:e,gfx:s}),e};d.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)};d.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)};d.prototype._removeElement=function(t,e){const n=this._elementRegistry,r=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t),!!t)return i.fire(e+".remove",{element:t}),r.remove(t),mr(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t};d.prototype.removeShape=function(t){return this._removeElement(t,"shape")};d.prototype.removeConnection=function(t){return this._removeElement(t,"connection")};d.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)};d.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()};d.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})};d.prototype.viewbox=function(t){if(t===void 0&&this._cachedViewbox)return structuredClone(this._cachedViewbox);const e=this._viewport,n=this.getSize();let r,i,o,s,a,c,l;if(t)this._changeViewbox(function(){a=Math.min(n.width/t.width,n.height/t.height);const y=this._svg.createSVGMatrix().scale(a).translate(-t.x,-t.y);at(e,y)});else return o=this._rootElement?this.getActiveLayer():null,r=o&&o.getBBox()||{},s=at(e),i=s?s.matrix:Rn(),a=mt(i.a,1e3),c=mt(-i.e||0,1e3),l=mt(-i.f||0,1e3),t=this._cachedViewbox={x:c?c/a:0,y:l?l/a:0,width:n.width/a,height:n.height/a,scale:a,inner:{width:r.width||0,height:r.height||0,x:r.x||0,y:r.y||0},outer:n},t;return t};d.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=C({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),Ie(e,n)}),{x:n.e,y:n.f}};d.prototype.scrollToElement=function(t,e){let n=100;typeof t=="string"&&(t=this._elementRegistry.get(t));const r=this.findRoot(t);if(r!==this.getRootElement()&&this.setRootElement(r),r===t)return;e||(e={}),typeof e=="number"&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=ct(t),o=ee(i),s=this.viewbox(),a=this.zoom();let c,l;s.y+=e.top/a,s.x+=e.left/a,s.width-=(e.right+e.left)/a,s.height-=(e.bottom+e.top)/a;const y=ee(s);if(!(i.width<s.width&&i.height<s.height))c=i.x-s.x,l=i.y-s.y;else{const T=Math.max(0,o.right-y.right),j=Math.min(0,o.left-y.left),I=Math.max(0,o.bottom-y.bottom),M=Math.min(0,o.top-y.top);c=T||j,l=I||M}this.scroll({dx:-c*a,dy:-l*a})};d.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if(t==="fit-viewport")return this._fitViewport(e);let n,r;return this._changeViewbox(function(){typeof e!="object"&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),r=this._setZoom(t,e)}),mt(r.a,1e3)};function Ie(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}d.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,r=e.inner;let i,o;return r.x>=0&&r.y>=0&&r.x+r.width<=n.width&&r.y+r.height<=n.height&&!t?o={x:0,y:0,width:Math.max(r.width+r.x,n.width),height:Math.max(r.height+r.y,n.height)}:(i=Math.min(1,n.width/r.width,n.height/r.height),o={x:r.x+(t?r.width/2-n.width/i/2:0),y:r.y+(t?r.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(o),this.viewbox(!1).scale};d.prototype._setZoom=function(t,e){const n=this._svg,r=this._viewport,i=n.createSVGMatrix(),o=n.createSVGPoint();let s,a,c,l,y;c=r.getCTM();const w=c.a;return e?(s=C(o,e),a=s.matrixTransform(c.inverse()),l=i.translate(a.x,a.y).scale(1/w*t).translate(-a.x,-a.y),y=c.multiply(l)):y=i.scale(t),Ie(this._viewport,y),y};d.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}};d.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;t.waypoints?n=this.getGraphics(t).getBBox():n=t;const r=n.x*e.scale-e.x*e.scale,i=n.y*e.scale-e.y*e.scale,o=n.width*e.scale,s=n.height*e.scale;return{x:r,y:i,width:o,height:s}};d.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var nt="data-element-id";function A(t){this._elements={},this._eventBus=t}A.$inject=["eventBus"];A.prototype.add=function(t,e,n){var r=t.id;this._validateId(r),E(e,nt,r),n&&E(n,nt,r),this._elements[r]={element:t,gfx:e,secondaryGfx:n}};A.prototype.remove=function(t){var e=this._elements,n=t.id||t,r=n&&e[n];r&&(E(r.gfx,nt,""),r.secondaryGfx&&E(r.secondaryGfx,nt,""),delete e[n])};A.prototype.updateId=function(t,e){this._validateId(e),typeof t=="string"&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),r=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,r)};A.prototype.updateGraphics=function(t,e,n){var r=t.id||t,i=this._elements[r];return n?i.secondaryGfx=e:i.gfx=e,e&&E(e,nt,r),e};A.prototype.get=function(t){var e;typeof t=="string"?e=t:e=t&&E(t,nt);var n=this._elements[e];return n&&n.element};A.prototype.filter=function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(n)}),e};A.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],o=e[i],s=o.element,a=o.gfx;if(t(s,a))return s}};A.prototype.getAll=function(){return this.filter(function(t){return t})};A.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var r=e[n],i=r.element,o=r.gfx;return t(i,o)})};A.prototype.getGraphics=function(t,e){var n=t.id||t,r=this._elements[n];return r&&(e?r.secondaryGfx:r.gfx)};A.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};function Or(t,e,n,r){var i=n.inverse;return Object.defineProperty(t,"remove",{value:function(o){var s=this.indexOf(o);return s!==-1&&(this.splice(s,1),e.unset(o,i,r)),o}}),Object.defineProperty(t,"contains",{value:function(o){return this.indexOf(o)!==-1}}),Object.defineProperty(t,"add",{value:function(o,s){var a=this.indexOf(o);if(typeof s>"u"){if(a!==-1)return;s=this.length}a!==-1&&this.splice(a,1),this.splice(s,0,o),a===-1&&e.set(o,i,r)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t}function Sr(t){return t.__refs_collection===!0}function Tr(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)}function Ne(t,e,n){var r=Or(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:r}),r.length&&r.forEach(function(i){t.set(i,e.inverse,n)})}function jr(t,e,n){var r=e.inverse,i=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return i},set:function(o){if(o!==i){var s=i;i=null,s&&t.unset(s,r,n),i=o,t.set(i,r,n)}}})}function F(t,e){if(!(this instanceof F))return new F(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}F.prototype.bind=function(t,e){if(typeof e=="string"){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?Ne(this,e,t):jr(this,e,t)};F.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return Sr(n)||Ne(this,e,t),n};F.prototype.ensureBound=function(t,e){Tr(t,e)||this.bind(t,e)};F.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)};F.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var zt=new F({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Fe=new F({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),se=new F({name:"attachers",collection:!0},{name:"host"}),$e=new F({name:"outgoing",collection:!0},{name:"source"}),Ve=new F({name:"incoming",collection:!0},{name:"target"});function ht(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),zt.bind(this,"parent"),Fe.bind(this,"labels"),$e.bind(this,"outgoing"),Ve.bind(this,"incoming")}function dt(){ht.call(this),zt.bind(this,"children"),se.bind(this,"host"),se.bind(this,"attachers")}ft(dt,ht);function Ge(){ht.call(this),zt.bind(this,"children")}ft(Ge,dt);function He(){dt.call(this),Fe.bind(this,"labelTarget")}ft(He,dt);function De(){ht.call(this),$e.bind(this,"source"),Ve.bind(this,"target")}ft(De,ht);var Mr={connection:De,shape:dt,label:He,root:Ge};function Lr(t,e){var n=Mr[t];if(!n)throw new Error("unknown type: <"+t+">");return C(new n,e)}function ot(){this._uid=12}ot.prototype.createRoot=function(t){return this.create("root",t)};ot.prototype.createLabel=function(t){return this.create("label",t)};ot.prototype.createShape=function(t){return this.create("shape",t)};ot.prototype.createConnection=function(t){return this.create("connection",t)};ot.prototype.create=function(t,e){return e=C({},e||{}),e.id||(e.id=t+"_"+this._uid++),Lr(t,e)};var Et="__fn",Ye=1e3,Pr=Array.prototype.slice;function P(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}P.prototype.on=function(t,e,n,r){if(t=$(t)?t:[t],X(e)&&(r=n,n=e,e=Ye),!Z(e))throw new Error("priority must be a number");var i=n;r&&(i=ge(n,r),i[Et]=n[Et]||n);var o=this;t.forEach(function(s){o._addListener(s,{priority:e,callback:i,next:null})})};P.prototype.once=function(t,e,n,r){var i=this;if(X(e)&&(r=n,n=e,e=Ye),!Z(e))throw new Error("priority must be a number");function o(){o.__isTomb=!0;var s=n.apply(r,arguments);return i.off(t,o),s}o[Et]=n,this.on(t,e,o)};P.prototype.off=function(t,e){t=$(t)?t:[t];var n=this;t.forEach(function(r){n._removeListener(r,e)})};P.prototype.createEvent=function(t){var e=new pt;return e.init(t),e};P.prototype.fire=function(t,e){var n,r,i,o;if(o=Pr.call(arguments),typeof t=="object"&&(e=t,t=e.type),!t)throw new Error("no event type specified");if(r=this._listeners[t],!!r){e instanceof pt?n=e:n=this.createEvent(e),o[0]=n;var s=n.type;t!==s&&(n.type=t);try{i=this._invokeListeners(n,o,r)}finally{t!==s&&(n.type=s)}return i===void 0&&n.defaultPrevented&&(i=!1),i}};P.prototype.handleError=function(t){return this.fire("error",{error:t})===!1};P.prototype._destroy=function(){this._listeners={}};P.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r};P.prototype._invokeListener=function(t,e,n){var r;if(n.callback.__isTomb)return r;try{r=Br(n.callback,e),r!==void 0&&(t.returnValue=r,t.stopPropagation()),r===!1&&t.preventDefault()}catch(i){if(!this.handleError(i))throw console.error("unhandled error in event listener",i),i}return r};P.prototype._addListener=function(t,e){var n=this._getListeners(t),r;if(!n){this._setListeners(t,e);return}for(;n;){if(n.priority<e.priority){e.next=n,r?r.next=e:this._setListeners(t,e);return}r=n,n=n.next}r.next=e};P.prototype._getListeners=function(t){return this._listeners[t]};P.prototype._setListeners=function(t,e){this._listeners[t]=e};P.prototype._removeListener=function(t,e){var n=this._getListeners(t),r,i,o;if(!e){this._setListeners(t,null);return}for(;n;)r=n.next,o=n.callback,(o===e||o[Et]===e)&&(i?i.next=r:this._setListeners(t,r)),i=n,n=r};function pt(){}pt.prototype.stopPropagation=function(){this.cancelBubble=!0};pt.prototype.preventDefault=function(){this.defaultPrevented=!0};pt.prototype.init=function(t){C(this,t||{})};function Br(t,e){return t.apply(null,e)}function Ar(t){return t.childNodes[0]}function kr(t){return t.parentNode.childNodes[1]}function k(t,e){this._eventBus=t,this._elementRegistry=e}k.$inject=["eventBus","elementRegistry"];k.prototype._getChildrenContainer=function(t){var e=this._elementRegistry.getGraphics(t),n;return t.parent?(n=kr(e),n||(n=L("g"),H(n).add("djs-children"),G(e.parentNode,n))):n=e,n};k.prototype._clear=function(t){var e=Ar(t);return ue(e),e};k.prototype._createContainer=function(t,e,n,r){var i=L("g");H(i).add("djs-group"),typeof n<"u"?ze(i,e,e.childNodes[n]):G(e,i);var o=L("g");H(o).add("djs-element"),H(o).add("djs-"+t),r&&H(o).add("djs-frame"),G(i,o);var s=L("g");return H(s).add("djs-visual"),G(o,s),o};k.prototype.create=function(t,e,n){var r=this._getChildrenContainer(e.parent);return this._createContainer(t,r,n,Re(e))};k.prototype.updateContainments=function(t){var e=this,n=this._elementRegistry,r;r=et(t,function(i,o){return o.parent&&(i[o.parent.id]=o.parent),i},{}),x(r,function(i){var o=i.children;if(o){var s=e._getChildrenContainer(i);x(o.slice().reverse(),function(a){var c=n.getGraphics(a);ze(c.parentNode,s)})}})};k.prototype.drawShape=function(t,e,n={}){var r=this._eventBus;return r.fire("render.shape",{gfx:t,element:e,attrs:n})};k.prototype.getShapePath=function(t){var e=this._eventBus;return e.fire("render.getShapePath",t)};k.prototype.drawConnection=function(t,e,n={}){var r=this._eventBus;return r.fire("render.connection",{gfx:t,element:e,attrs:n})};k.prototype.getConnectionPath=function(t){var e=this._eventBus;return e.fire("render.getConnectionPath",t)};k.prototype.update=function(t,e,n){if(e.parent){var r=this._clear(n);if(t==="shape")this.drawShape(r,e),kn(n,e.x,e.y);else if(t==="connection")this.drawConnection(r,e);else throw new Error("unknown type: "+t);e.hidden?E(n,"display","none"):E(n,"display","block")}};k.prototype.remove=function(t){var e=this._elementRegistry.getGraphics(t);lt(e.parentNode)};function ze(t,e,n){var r=n||e.firstChild;t!==r&&e.insertBefore(t,r)}const Ir={__depends__:[_r],__init__:["canvas"],canvas:["type",d],elementRegistry:["type",A],elementFactory:["type",ot],eventBus:["type",P],graphicsFactory:["type",k]};function Nr(t){var e=new Be(t);return e.init(),e}function Fr(t){t=t||{};var e={config:["value",t]},n=[e,Ir].concat(t.modules||[]);return Nr(n)}function Tt(t,e){this._injector=e||Fr(t),this.get("eventBus").fire("diagram.init")}Tt.prototype.get=function(t,e){return this._injector.get(t,e)};Tt.prototype.invoke=function(t,e,n){return this._injector.invoke(t,e,n)};Tt.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")};Tt.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")};export{P as $,Wr as A,Q as B,Qn as C,V as D,ee as E,Xr as F,ge as G,It as H,U as I,Dr as J,Yr as K,$r as L,Wt as M,Gr as N,Qr as O,rt as P,Tt as Q,Ur as R,At as S,Dt as T,zr as U,Z as V,ti as W,$ as X,X as Y,en as Z,Jr as _,ft as a,yn as a0,ye as a1,tt as a2,F as a3,ae as a4,Hr as a5,Be as a6,et as a7,L as b,ce as c,bt as d,le as e,Ct as f,_n as g,E as h,fn as i,ue as j,qt as k,C as l,ve as m,Ht as n,Rt as o,G as p,un as q,lt as r,Vr as s,Kr as t,be as u,H as v,qr as w,kn as x,x as y,Zr as z};
